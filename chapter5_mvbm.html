---
layout: chapter
title: Multivariate Brownian motion
---
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
</head>
<body>
<div id="TOC">
<ul>
<li><a href="#chapter-5-fitting-brownian-motion-models-to-multiple-characters">Chapter 5: Fitting Brownian Motion Models to Multiple Characters</a><ul>
<li><a href="#section-5.1-introduction">Section 5.1: Introduction</a></li>
<li><a href="#section-5.2-what-is-evolutionary-correlation">Section 5.2: What is evolutionary correlation?</a></li>
<li><a href="#section-5.3-modeling-the-evolution-of-correlated-characters">Section 5.3: Modeling the evolution of correlated characters</a></li>
<li><a href="#section-5.4-testing-for-evolutionary-correlations">Section 5.4: Testing for evolutionary correlations</a><ul>
<li><a href="#section-5.4a-testing-for-character-correlations-using-maximum-likelihood-and-aic">Section 5.4a: Testing for character correlations using maximum likelihood and AIC</a></li>
<li><a href="#section-5.4b-testing-for-character-correlations-using-bayesian-model-selection">Section 5.4b: Testing for character correlations using Bayesian model selection</a></li>
<li><a href="#section-5.5c-testing-for-character-correlations-using-traditional-approaches-pic-pgls">Section 5.5c: Testing for character correlations using traditional approaches (PIC, PGLS)</a></li>
</ul></li>
<li><a href="#section-5.6-summary">Section 5.6: Summary</a></li>
<li><a href="#section-5.7-footnotes">Section 5.7: Footnotes</a></li>
</ul></li>
</ul>
</div>
<div>
<p><a href="{{site.baseurl}}/pdf/chapter5_mvbm.pdf">pdf version</a></p>
</div>
<h1 id="chapter-5-fitting-brownian-motion-models-to-multiple-characters">Chapter 5: Fitting Brownian Motion Models to Multiple Characters</h1>
<h2 id="section-5.1-introduction">Section 5.1: Introduction</h2>
<p>As discussed in <a href="{{site.baseurl}}/chapter4_fitbm">Chapter 4</a>, body size is one of the most important traits of an animal. Body size has a close relationship to almost all of an animal’s ecological interactions, from whether it is a predator or prey to its metabolic rate. If that is true, we should be able to use body size to predict other traits that might be related through shared evolutionary processes. We need to understand how the evolution of body size is correlated with other species’ characteristics.</p>
<p>A wide variety of hypotheses can be framed as tests of correlations between continuously varying traits across species. For example, is the body size of a species related to its metabolic rate? How does the head length of a species relate to overall size, and do deviations from this relationship relate to an animal’s diet? These questions and others like them are of interest to evolutionary biologists because they allow us to test hypotheses about the factors in influencing character evolution over long time scales. These types of approaches allow us to answer some of the classic “why” questions in biology. Why are elephants so large? Why do some species of crocodilians have longer heads than others? If we find a correlation between two characters, we might suspect that there is a causal relationship between our two variables of interest - or perhaps that both of our measured variables share a common cause.</p>
<p>In this chapter, we will use the example of home range size, which is the area where an animal carries out its day-to-day activities. We will again use data from Garland <span class="citation">(<a href="#ref-Garland1992-kv">1992</a>)</span> and test for a relationship between body size and the size of a mammal’s home range. I will describe methods for using empirical data to estimate the parameters of multivariate Brownian motion models. I will then describe a model-fitting approach to test for evolutionary correlations. This model fitting approach is simple but not commonly used. Finally, I will review two common statistical approaches to test for evolutionary correlations, phylogenetic independent contrasts and phylogenetic generalized least squares, and describe their relationship to model-fitting approaches.</p>
<h2 id="section-5.2-what-is-evolutionary-correlation">Section 5.2: What is evolutionary correlation?</h2>
<p>There is sometimes a bit of confusion among beginners as to what, exactly, we are doing when we carry out a comparative method, especially when testing for character correlations. Common language that comparative methods “control for phylogeny” or “remove the phylogeny from the data” is not necessarily enlightening or even always accurate. Another common suggestion is that species are not statistically independent and that we must account for that with comparative methods. While accurate, I still don’t think this statement fully captures the tree-thinking perspective enabled by comparative methods. In this section, I will use the particular example of correlated evolution to try to illustrate the power of comparative methods and how they differ from standard statistical approaches that do not use phylogenies.</p>
<p>In statistics, two variables can be correlated with one another. We might refer to this as a <em>standard correlation</em>. When two traits are correlated, it means that given the value of one trait – say, body size in mammals – one can predict the value of another – like home range area. Correlations can be positive (large values of <span class="math inline"><em>x</em></span> are associated with large values of <span class="math inline"><em>y</em></span>) or negative (large values of <span class="math inline"><em>x</em></span> are associated with small values of <span class="math inline"><em>y</em></span>). A surprisingly wide variety of hypotheses in biology can be tested by evaluating correlations between characters.</p>
<p>In comparative biology, we are often interested more specifically in <em>evolutionary correlations</em>. Evolutionary correlations occur when two traits tend to evolve together due to processes like mutation, genetic drift, or natural selection. If there is an evolutionary correlation between two characters, it means that we can predict the magnitude and direction of changes in one character given knowledge of evolutionary changes in another. Just like standard correlations, evolutionary correlations can be positive (increases in trait <span class="math inline"><em>x</em></span> are associated with increases in <span class="math inline"><em>y</em></span>) or negative (decreases in <span class="math inline"><em>x</em></span> are associated with increases in <span class="math inline"><em>y</em></span>).</p>
<p>We can now contrast standard correlations, testing the relationships between trait values across a set of species, with evolutionary correlations - where evolutionary changes in two traits are related to each other. This is a key distinction, because phylogenetic relatedness alone can lead to a relationship between two variables that are not, in fact, evolving together <span class="citation">(Figure 5.1; also see Felsenstein <a href="#ref-Felsenstein1985-bt">1985</a>)</span>. In such cases, standard correlations will, correctly, tell us that one can predict the value of trait <span class="math inline"><em>y</em></span> by knowing the value of trait <span class="math inline"><em>x</em></span>, at least among extant species; but we would be misled if we tried to make any evolutionary causal inference from this pattern. In the example of Figure 5.1, we can only predict <span class="math inline"><em>x</em></span> from <span class="math inline"><em>y</em></span> because the value of trait <span class="math inline"><em>x</em></span> tells us which clade the species belongs to, which, in turn, allows reasonable prediction of <span class="math inline"><em>y</em></span>. In fact, this is a classical example of a case where correlation is not causation: the two variables are only correlated with one another because both are related to phylogeny.</p>
<p>If we want to test hypotheses about trait evolution, we should specifically test evolutionary correlations<sup><a name="footnote5.1_back"><a href="#footnote5.1"><span class="math inline"><em></em><sup>1</sup></span></a></a></sup>. If we find a relationship among the independent contrasts for two characters, for example, then we can infer that changes in each character are related to changes in the other – an inference that is much closer to most biological hypotheses about why characters might be related. In this case, then, we can think of statistical comparative methods as focused on disentangling patterns due to phylogenetic relatedness from patterns due to traits evolving in a correlated manner.</p>
<div class="figure">
<img src="{{site.baseurl}}/images/figure5-1.png" alt="Figure 5.1. Examples from simulations of pure birth trees (b = 1) with n = 100 species. Plotted points represent character values for extant species in each clade. In all three panels, \sigma_x^2 = \sigma_y^2 = 1. \sigma_{xy}^2 varies with \sigma_{xy}^2 = 0 (panel A), \sigma_{xy}^2 = 0.8 (panel B), and \sigma_{xy}^2 = -0.8 (panel C). Note the (apparent) negative correlation in panel A, which can be explained by phylogenetic relatedness of species within two clades. Only panels B and C show data with an evolutionary correlation. However, this would be difficult or impossible to conclude without using comparative methods." />
<p class="caption">Figure 5.1. Examples from simulations of pure birth trees (<span class="math inline"><em>b</em> = 1</span>) with <span class="math inline"><em>n</em> = 100</span> species. Plotted points represent character values for extant species in each clade. In all three panels, <span class="math inline"><em>σ</em><sub><em>x</em></sub><sup>2</sup> = <em>σ</em><sub><em>y</em></sub><sup>2</sup> = 1</span>. <span class="math inline"><em>σ</em><sub><em>x</em><em>y</em></sub><sup>2</sup></span> varies with <span class="math inline"><em>σ</em><sub><em>x</em><em>y</em></sub><sup>2</sup> = 0</span> (panel A), <span class="math inline"><em>σ</em><sub><em>x</em><em>y</em></sub><sup>2</sup> = 0.8</span> (panel B), and <span class="math inline"><em>σ</em><sub><em>x</em><em>y</em></sub><sup>2</sup> = −0.8</span> (panel C). Note the (apparent) negative correlation in panel A, which can be explained by phylogenetic relatedness of species within two clades. Only panels B and C show data with an evolutionary correlation. However, this would be difficult or impossible to conclude without using comparative methods.</p>
</div>
<h2 id="section-5.3-modeling-the-evolution-of-correlated-characters">Section 5.3: Modeling the evolution of correlated characters</h2>
<p>We can model the evolution of multiple (potentially correlated) continuous characters using a multivariate Brownian motion model. This model is similar to univariate Brownian motion (see chapter 3), but can model the evolution of many characters at the same time. As with univariate Brownian motion, trait values change randomly in both direction and distance over any time interval. Here, though, these changes are drawn from multivariate normal distributions<sup><a name="footnote5.2_back"><a href="#footnote5.2"><span class="math inline"><em></em><sup>2</sup></span></a></a></sup>. Multivariate Brownian motion can encompass the situation where each character evolves independently of one another, but can also describe situations where characters evolve in a correlated way.</p>
<p>We can describe multivariate Brownian motion with a set of parameters that are described by <span class="math inline"><strong>a</strong></span>, a vector of phylogenetic means for a set of <span class="math inline"><em>r</em></span> characters:</p>
(eq. 5.1)
<div>
<p><br /><span class="math display">$$
\mathbf{a} =
\begin{bmatrix}
\bar{z}_1 (0) &amp; \bar{z}_2 (0) &amp; \dots &amp; \bar{z}_r (0)\\
\end{bmatrix}
$$</span><br /></p>
</div>
<p>This vector represents the starting point in <span class="math inline"><em>r</em></span>-dimensional space for our random walk. In the context of comparative methods, this is the character measurements for the lineage at the root of the tree. Additionally, we have an evolutionary rate matrix <span class="math inline"><strong>R</strong></span>:</p>
(eq. 5.2)
<div>
<p><br /><span class="math display">$$
\mathbf{R} =
\begin{bmatrix}
    \sigma_1^2 &amp; \sigma_{21} &amp; \dots &amp; \sigma_{n1}\\
    \sigma_{21} &amp; \sigma_2^2 &amp; \dots &amp; \vdots\\
    \vdots &amp; \vdots &amp; \ddots &amp; \vdots\\
    \sigma_{1n} &amp; \dots &amp; \dots &amp; \sigma_{rn}^2\\
\end{bmatrix}$$</span><br /></p>
</div>
<p>Here, the rate parameter for each axis (<span class="math inline"><em>σ</em><sub><em>i</em></sub><sup>2</sup></span>) is along the matrix diagonal. Off-diagonal elements represent evolutionary covariances between pairs of axes (note that <span class="math inline"><em>σ</em><sub><em>i</em><em>j</em></sub> = <em>σ</em><sub><em>j</em><em>i</em></sub></span>). It is worth noting that each individual character evolves under a Brownian motion process. Covariances among characters, though, potentially make this model distinct from one where each character evolves independently of all the others (Figure 5.2).</p>
<div class="figure">
<img src="{{site.baseurl}}/images/figure5-2.png" alt="Figure 5.2. Hypothetical pathways of evolution (arrows) for (A) two uncorrelated traits, (B) two traits evolving with a positive covariance, and (C) two traits evolving with a negative covariance. Note that in (B), when trait 1 gets larger trait 2 also gets larger, but in (C) positive changes in trait 1 are paired with negative changes in trait 2." />
<p class="caption">Figure 5.2. Hypothetical pathways of evolution (arrows) for (A) two uncorrelated traits, (B) two traits evolving with a positive covariance, and (C) two traits evolving with a negative covariance. Note that in (B), when trait 1 gets larger trait 2 also gets larger, but in (C) positive changes in trait 1 are paired with negative changes in trait 2.</p>
</div>
<p>When you have data for multiple continuous characters across many species along with a phylogenetic tree, you can fit a multivariate Brownian motion model to the data, as discussed in Chapter 3.</p>
<p>To calculate the likelihood, we can use the fact that, under our multivariate Brownian motion model, the joint distribution of all traits across all species has a multivariate normal distribution. Following Chapter 3, we find the variance-covariance matrix that describes that model by combining the two matrices <span class="math inline"><strong>R</strong></span> and <span class="math inline"><strong>C</strong></span> into a single large matrix using the Kroeneker product:</p>
(eq. 5.3)<br />

<div>
<p><br /><span class="math display"><strong>V</strong> = <strong>R</strong> ⊗ <strong>C</strong></span><br /></p>
</div>
<p>This matrix <span class="math inline"><strong>V</strong></span> is <span class="math inline"><em>n</em><em>r</em> × <em>n</em><em>r</em></span>. We can then substitute <span class="math inline"><strong>V</strong></span> for <span class="math inline"><strong>C</strong></span> in equation (4.5) to calculate the likelihood:</p>
(eq. 5.4)
<div>
<p><br /><span class="math display">$$
L(\mathbf{x}_{nr} | \mathbf{a}, \mathbf{R}, \mathbf{C}) =
\frac
{e^{-1/2 (\mathbf{x}_{nr}- \mathbf{D} \cdot \mathbf{a})^\intercal (\mathbf{V})^{-1} (\mathbf{x}_nr-\mathbf{D} \cdot \mathbf{a})}}
{\sqrt{(2 \pi)^{nm} det(\mathbf{V})}}
$$</span><br /></p>
</div>
<p>Here <span class="math inline"><strong>D</strong></span> is an <span class="math inline"><em>n</em><em>r</em> × <em>r</em></span> design matrix where each element <span class="math inline"><strong>D</strong><sub><em>i</em><em>j</em></sub></span> is 1 if <span class="math inline">(<em>j</em> − 1)⋅<em>n</em> &lt; <em>i</em> ≤ <em>j</em> ⋅ <em>n</em></span> and 0 otherwise. <span class="math inline"><strong>x</strong><sub><em>n</em><em>r</em></sub></span> is a single vector with all trait values for all species, listed so that the first <span class="math inline"><em>n</em></span> elements in the vector are trait 1, the next <span class="math inline"><em>n</em></span> are for trait 2, and so on:</p>
(eq. 5.5)
<div>
<p><br /><span class="math display">$$
\mathbf{x}_{nr} =
\begin{bmatrix}
x_{11} &amp; x_{12} &amp; \dots &amp; x_{1n} &amp; x_{21} &amp; \dots &amp; x_{nr}\\
\end{bmatrix}
$$</span><br /></p>
</div>
<p>We can find the value of the likelihood at its maximum by calculating <span class="math inline"><em>L</em>(<strong>x</strong><sub><em>n</em><em>r</em></sub>|<strong>a</strong>, <strong>R</strong>, <strong>C</strong>)</span> using eq. 5.4 and an optimization routine to find the MLE.</p>
<p>Alternatively, one can calculate this MLE solution directly. Equations for estimating <span class="math inline">$\hat{\mathbf{a}}$</span> (the estimated vector of phylogenetic means for all characters) and <span class="math inline">$\hat{\mathbf{R}}$</span> (the estimated evolutionary rate matrix) are <span class="citation">(Revell and Harmon <a href="#ref-Revell2008-qr">2008</a>, <span class="citation">Hohenlohe and Arnold (<a href="#ref-Hohenlohe2008-sj">2008</a>)</span>)</span>:</p>
(eq. 5.6)
<div>
<p><br /><span class="math display">$$
\hat{\mathbf{a}} = [(\mathbf{1} \mathbf{C}^{-1} \mathbf{1})^{-1}(\mathbf{1} \mathbf{C}^{-1} \mathbf{X})]^\intercal
$$</span><br /></p>
</div>
(eq. 5.7)
<div>
<p><br /><span class="math display">$$
\hat{\mathbf{R}} = \frac{(\mathbf{X} - \mathbf{1} \mathbf{\hat{a}})^\intercal \mathbf{C}^{-1} (\mathbf{X} - \mathbf{1} \mathbf{\hat{a}})}{n}
$$</span><br /></p>
</div>
<p>Note here that we use <span class="math inline"><strong>X</strong></span> to denote the <span class="math inline"><em>n</em></span> (species) <span class="math inline">×</span> <span class="math inline"><em>r</em></span> (traits) matrix of all traits across all species. Note the similarity between these multivariate equations (5.6 and 5.7) and their univariate equivalents (equations 4.6 and 4.7).</p>
<h2 id="section-5.4-testing-for-evolutionary-correlations">Section 5.4: Testing for evolutionary correlations</h2>
<p>There are many ways to test for evolutionary correlations between two characters. Traditional methods like PICs and PGLS work great for testing evolutionary regression, which is very similar to testing for evolutionary correlations. However, when using those methods the connection to actual models of character evolution can remain opaque. Thus, I will first present approaches to test for correlated evolution based on model selection using AIC and Bayesian analysis. I will then return to “standard” methods for evolutionary regression at the end of the chapter.</p>
<h3 id="section-5.4a-testing-for-character-correlations-using-maximum-likelihood-and-aic">Section 5.4a: Testing for character correlations using maximum likelihood and AIC</h3>
<p>To test for an evolutionary correlation between two characters, we are really interested in the elements in the matrix <span class="math inline"><strong>R</strong></span>. For two characters, <span class="math inline"><em>x</em></span> and <span class="math inline"><em>y</em></span>, <span class="math inline"><strong>R</strong></span> can be written as:</p>
(eq. 5.8)<br />

<div>
<p><br /><span class="math display">$$
\mathbf{R} =
\begin{bmatrix}
\sigma_x^2 &amp; \sigma_{xy} \\
\sigma_{xy} &amp; \sigma_y^2 \\
\end{bmatrix}
$$</span><br /></p>
</div>
<p>We are interested in the parameter <span class="math inline"><em>σ</em><sub><em>x</em><em>y</em></sub></span> - the evolutionary covariance - and whether it is equal to zero (no correlation) or not. One simple way to test this hypothesis is to set up two competing hypotheses and compare them to each other. One hypothesis (<span class="math inline"><em>H</em><sub>1</sub></span>) is that the traits evolve independently of each other, and another (<span class="math inline"><em>H</em><sub>2</sub></span>) that the traits evolve with some covariance <span class="math inline"><em>σ</em><sub><em>x</em><em>y</em></sub></span>. We can write these two rate matrices as:</p>
(eq. 5.9)
<div>
<p><br /><span class="math display">$$
\begin{array}{lcr}
\mathbf{R}_{H_1} =
\begin{bmatrix}
\sigma_x^2 &amp; 0 \\
0 &amp; \sigma_y^2 \\
\end{bmatrix} &amp;
\mathbf{R}_{H_2} =
\begin{bmatrix}
\sigma_x^2 &amp; \sigma_{xy} \\
\sigma_{xy} &amp; \sigma_y^2 \\
\end{bmatrix}\\
\end{array}
$$</span><br /></p>
</div>
<p>We can calculate an ML estimate of the parameters in <span class="math inline"><strong>R</strong><sub><em>H</em><sub>2</sub></sub></span> using equation 5.4. The maximum likelihood estimate of <span class="math inline"><strong>R</strong><sub><em>H</em><sub>1</sub></sub></span> can be obtained by noting that, if character evolution is independent across all characters, then both <span class="math inline"><em>σ</em><sub><em>x</em></sub><sup>2</sup></span> and <span class="math inline"><em>σ</em><sub><em>y</em></sub><sup>2</sup></span> can be obtained by treating each character separately and using equations from chapter 3 to solve for each. It turns out that the ML estimates for <span class="math inline"><em>σ</em><sub><em>x</em></sub><sup>2</sup></span> and <span class="math inline"><em>σ</em><sub><em>y</em></sub><sup>2</sup></span> are always exactly the same for <span class="math inline"><em>H</em><sub>1</sub></span> and <span class="math inline"><em>H</em><sub>2</sub></span>.</p>
<p>To compare these two models, we calculate the likelihood of each using equation 5.5. We can then compare these two likelihoods using either a likelihood ratio test or by comparing AICc scores (see <a href="%7B%7Bsite.baseurl%7D%7D/chapter2_stats/">chapter 2</a>).</p>
<div class="figure">
<img src="{{site.baseurl}}/images/figure5-3.png" alt="Figure 5.3. The relationship between mammal body mass and home-range size. To illustrate the effect of accounting for a tree, I plot a solid line for the regression line from a standard analysis, and dotted line from PGLS, which uses the phylogenetic tree. These methods are discussed in more detail in the next section." />
<p class="caption">Figure 5.3. The relationship between mammal body mass and home-range size. To illustrate the effect of accounting for a tree, I plot a solid line for the regression line from a standard analysis, and dotted line from PGLS, which uses the phylogenetic tree. These methods are discussed in more detail in the next section.</p>
</div>
<p>For the mammal example, we can consider the two traits of (ln-transformed) body size and home range size <span class="citation">(Garland <a href="#ref-Garland1992-kv">1992</a>)</span>. These two characters have a positive correlation using standard regression analysis (<span class="math inline"><em>r</em> = 0.27</span>), and a linear regression is significant (<span class="math inline"><em>P</em> = 0.0001</span>; Figure 5.3). If we fit a multivariate Brownian motion model to these data, considering home range as trait 1 and body mass as trait 2, we obtain the following parameter estimates:</p>
(eq. 5.10)
<div>
<p><br /><span class="math display">$$
\begin{array}{cc}
\hat{\mathbf{a}}_{H_2} =
\begin{bmatrix}
2.54 \\
4.64 \\
\end{bmatrix} &amp;
\hat{\mathbf{R}}_{H_2} =
\begin{bmatrix}
0.24 &amp; 0.10 \\
0.10 &amp; 0.09 \\
\end{bmatrix}\\
\end{array}
$$</span><br /></p>
</div>
<p>Note the positive off-diagonal element in the estimated <span class="math inline"><strong>R</strong></span> matrix, suggesting a positive evolutionary correlation between these two traits. This model corresponds to hypothesis 2 above, and has a log-likelihood of <span class="math inline"><em>l</em><em>n</em><em>L</em> = −164.0</span>. If we fit a model with no correlation between the two traits, we obtain:</p>
(eq. 5.11)
<div>
<p><br /><span class="math display">$$
\begin{array}{cc}
\hat{\mathbf{a}}_{H_2} =
\begin{bmatrix}
2.54 \\
4.64 \\
\end{bmatrix} &amp;
\hat{\mathbf{R}}_{H_2} =
\begin{bmatrix}
0.24 &amp; 0 \\
0 &amp; 0.09 \\
\end{bmatrix}\\
\end{array}
$$</span><br /></p>
</div>
<p>It is worth noting again that only the estimates of the evolutionary correlation were affected by this model restriction; all other parameter estimates remain the same. This model has a smaller (more negative) log-likelihood of <span class="math inline"><em>l</em><em>n</em><em>L</em> = −180.5</span>.</p>
<p>A likelihood ratio test gives <span class="math inline"><em>Δ</em> = 33.0</span>, and <span class="math inline"><em>P</em> &lt; &lt;0.001</span>, rejecting the null hypothesis. The difference in <span class="math inline"><em>A</em><em>I</em><em>C</em><sub><em>c</em></sub></span> scores is 30.9, and the Akaike weight for model 2 is effectively 1.0. All ways of comparing these two models give strong support for hypothesis 2. We can conclude that there is an evolutionary correlation between body mass and home range size in mammals. What this means in evolutionary terms is that, across mammals, evolutionary changes in body mass tend to positively covary with changes in home range.</p>
<h3 id="section-5.4b-testing-for-character-correlations-using-bayesian-model-selection">Section 5.4b: Testing for character correlations using Bayesian model selection</h3>
<p>We can also implement a Bayesian approach to testing for the correlated evolution of two characters. The simplest way to do this is just to use the standard algorithm for Bayesian MCMC to fit a correlated model to the two characters. We can modify the algorithm presented in chapter 2 as follows:</p>
<ol style="list-style-type: decimal">
<li>Sample a set of starting parameter values <span class="math inline"><em>σ</em><sub><em>x</em></sub><sup>2</sup></span>, <span class="math inline"><em>σ</em><sub><em>y</em></sub><sup>2</sup></span>, <span class="math inline"><em>σ</em><sub><em>x</em><em>y</em></sub></span>, <span class="math inline">$\bar{z}_1(0)$</span>, and <span class="math inline">$\bar{z}_2 (0)$</span> from prior distributions. For this example, we can set our prior distribution as uniform between 0 and 1 for <span class="math inline"><em>σ</em><sub><em>x</em></sub><sup>2</sup></span> and <span class="math inline"><em>σ</em><sub><em>y</em></sub><sup>2</sup></span>, uniform from -1 to +1 for <span class="math inline"><em>σ</em><sub><em>x</em><em>y</em></sub></span>, uniform from 1 to 9 for <span class="math inline">$\bar{z}_1(0)$</span> (lnMass), and -3 to 5 for <span class="math inline">$\bar{z}_1(0)$</span> (lnHomerange).</li>
<li>Given the current parameter values, select new proposed parameter values using the proposal density <span class="math inline"><em>Q</em>(<em>p</em>′|<em>p</em>)</span>. Here, for all five parameter values, we will use a uniform proposal density with width 0.2, so that <span class="math inline"><em>Q</em>(<em>p</em>′|<em>p</em>)∼<em>U</em>(<em>p</em> − 0.1, <em>p</em> + 0.1)</span>.</li>
<li>Calculate three ratios:</li>
</ol>
<ul>
<li>a. The prior odds ratio, <span class="math inline"><em>R</em><sub><em>p</em><em>r</em><em>i</em><em>o</em><em>r</em></sub></span>. This is the ratio of the probability of drawing the parameter values p and p’ from the prior. Since our priors are uniform, <span class="math inline"><em>R</em><sub><em>p</em><em>r</em><em>i</em><em>o</em><em>r</em></sub> = 1</span>.</li>
<li>b. The proposal density ratio, <span class="math inline"><em>R</em><sub><em>p</em><em>r</em><em>o</em><em>p</em><em>o</em><em>s</em><em>a</em><em>l</em></sub></span>. This is the ratio of probability of proposals going from p to p’ and the reverse. Our proposal density is symmetrical, so that <span class="math inline"><em>Q</em>(<em>p</em>′|<em>p</em>)=<em>Q</em>(<em>p</em>|<em>p</em>′)</span> and <span class="math inline"><em>R</em><sub><em>p</em><em>r</em><em>o</em><em>p</em><em>o</em><em>s</em><em>a</em><em>l</em></sub> = 1</span>.</li>
<li>c. The likelihood ratio, <span class="math inline"><em>R</em><sub><em>l</em><em>i</em><em>k</em><em>e</em><em>l</em><em>i</em><em>h</em><em>o</em><em>o</em><em>d</em></sub></span>. This is the ratio of probabilities of the data given the two different parameter values. We can calculate these probabilities from equation 5.6 above (eq. 5.12).
<div>
<br /><span class="math display">$$
  R_{likelihood} = \frac{L(p'|D)}{L(p|D)} = \frac{P(D|p')}{P(D|p)}
  $$</span><br />
</div></li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Find <span class="math inline"><em>R</em><sub><em>a</em><em>c</em><em>c</em><em>e</em><em>p</em><em>t</em></sub></span>, the product of the prior odds, proposal density ratio, and the likelihood ratio. In this case, both the prior odds and proposal density ratios are 1, so <span class="math inline"><em>R</em><sub><em>a</em><em>c</em><em>c</em><em>e</em><em>p</em><em>t</em></sub> = <em>R</em><sub><em>l</em><em>i</em><em>k</em><em>e</em><em>l</em><em>i</em><em>h</em><em>o</em><em>o</em><em>d</em></sub></span>.</li>
<li>Draw a random number <span class="math inline"><em>x</em></span> from a uniform distribution between 0 and 1. If <span class="math inline"><em>x</em> &lt; <em>R</em><sub><em>a</em><em>c</em><em>c</em><em>e</em><em>p</em><em>t</em></sub></span>, accept the proposed value of all parameters; otherwise reject, and retain the current parameter values.</li>
<li>Repeat steps 2-5 a large number of times.</li>
</ol>
<p>We can then inspect the posterior distribution for the parameter is significantly greater than (or less than) zero. As an example, I ran this MCMC for 100,000 generations, discarding the first 10,000 generations as burn-in. I then sampled the posterior distribution every 100 generations, and obtained the following parameter estimates: <span class="math inline">$\hat{\sigma}_x^2 = 0.26$</span> (95% CI: 0.18 - 0.38), <span class="math inline">$\hat{\sigma}_y^2 = 0.10$</span> (95% CI: 0.06 -0.15), and <span class="math inline">$\hat{\sigma}_{xy} = 0.11$</span> (95% CI: 0.06 - 0.17; see Figure 5.4). These results are comparable to our ML estimates. Furthermore, the 95% CI for <span class="math inline">$\hat{\sigma}_{xy}$</span> does not overlap with 0; in fact, none of the 901 posterior estimates of <span class="math inline">$\hat{\sigma}_{xy}$</span> are less than zero. Again, we can conclude with confidence that there is an evolutionary correlation between these two characters.</p>
<h3 id="section-5.5c-testing-for-character-correlations-using-traditional-approaches-pic-pgls">Section 5.5c: Testing for character correlations using traditional approaches (PIC, PGLS)</h3>
<p>The approach outlined above, which tests for an evolutionary correlation among characters using model selection, is not typically applied in the comparative biology literature. Instead, most tests of character correlation rely on phylogenetic regression using one of two methods: phylogenetic independent contrasts (PICs) and phylogenetic general least squares (PGLS). PGLS is actually mathematically identical to PICs in the simple case described here, and more flexible than PICs for other models and types of characters. Here I will review both PICs and PGLS and explain how they work and how they relate to the models described above.</p>
<p>Phylogenetic independent contrasts can be used to carry out a regression test for the relationship between two different characters. To do this, one calculates standardized PICs for trait <span class="math inline"><em>x</em></span> and trait <span class="math inline"><em>y</em></span>. One then uses standard linear regression forced through the origin to test for a relationship between these two sets of PICs. It is necessary to force the regression through the origin because the direction of subtraction of contrasts across any node in the tree is arbitrary; a reflection of all of the contrasts across both axes simultaneously should have no effect on the analyses<sup><a name="footnote5.3_back"><a href="#footnote5.3"><span class="math inline"><em></em><sup>3</sup></span></a></a></sup>.</p>
<p>For mammal homerange and body mass, a PIC regression test shows a significant correlation between the two traits (<span class="math inline"><em>P</em> &lt; &lt;0.0001</span>; Figure 5.5).</p>
<div class="figure">
<img src="{{site.baseurl}}/images/figure5-4.png" alt="Figure 5.4. Regression based on independent contrasts. The regression line is forced through the origin." />
<p class="caption">Figure 5.4. Regression based on independent contrasts. The regression line is forced through the origin.</p>
</div>
<p>There is one drawback to PIC regression analysis, though – one does not recover an estimate of the intercept of the regression of <span class="math inline"><em>y</em></span> on <span class="math inline"><em>x</em></span> – that is, the value of <span class="math inline"><em>y</em></span> one would expect when <span class="math inline"><em>x</em> = 0</span>. The easiest way to get this parameter estimate is to instead use Phylogenetic Generalized Least Squares (PGLS). PGLS uses the common statistical machinery of generalized least squares, and applies it to phylogenetic comparative data. In normal generalized least squares, one constructs a model of the relationship between <span class="math inline"><em>y</em></span> and <span class="math inline"><em>x</em></span>, as:</p>
(eq. 5.13)
<div>
<p><br /><span class="math display"><strong>y</strong> = <strong>X</strong><sub><strong>D</strong></sub><strong>b</strong> + <em>ϵ</em></span><br /></p>
</div>
<p>Here, <span class="math inline"><strong>y</strong></span> is an <span class="math inline"><em>n</em> × 1</span> vector of trait values and <span class="math inline"><strong>b</strong></span> is a vector of unknown regression coefficients that must be estimated from the data. <span class="math inline"><strong>X</strong><sub><strong>D</strong></sub></span> is a design matrix including the traits that one wishes to test for a correlation with <span class="math inline"><em>y</em></span> and – if the model includes an intercept – a column of 1s. To test for correlations, we use:</p>
(eq. 5.14)
<div>
<p><br /><span class="math display">$$
\mathbf{X_D} =
\begin{bmatrix}
1 &amp; x_1 \\
1 &amp; x_2 \\
\dots &amp; \dots \\
1 &amp; x_n \\
\end{bmatrix}
$$</span><br /></p>
</div>
<p>In the case of one predictor and one response variable, <span class="math inline"><strong>b</strong></span> is <span class="math inline">2 × 1</span> and the resulting model can be used to test correlations between two characters. However, <span class="math inline"><strong>X</strong><sub><strong>D</strong></sub></span> could also be multivariate, and can include more than one character that might be related to <span class="math inline"><em>y</em></span>. This allows us to carry out the equivalent of multiple regression in a phylogenetic context. Finally, <span class="math inline"><em>ϵ</em></span> are the residuals – the difference between the y-values predicted by the model and their actual values. In traditional regression, one assumes that the residuals are all normally distributed with the same variance. By contrast, with GLS, one assumes that the residuals might not be independent of each other; instead, they are multivariate normal with expected mean zero and some variance-covariance matrix <span class="math inline"><strong>Ω</strong></span>.</p>
<p>In the case of Brownian motion, we can model the residuals as having variances and covariances that follow the structure of the phylogenetic tree. In other words, we can substitute our phylogenetic variance-covariance matrix <span class="math inline"><strong>C</strong></span> as the matrix <span class="math inline"><strong>Ω</strong></span>. We can then carry out standard GLS analyses to estimate model parameters:</p>
(eq. 5.15)
<div>
<p><br /><span class="math display">$$
\hat{\mathbf{b}} = (\mathbf{X}_D ^ \intercal \mathbf{\Omega}^{-1} \mathbf{X}_D ^ \intercal)^{-1} \mathbf{X}_D ^ \intercal \mathbf{\Omega}^{-1} \mathbf{y} = (\mathbf{X}_D ^ \intercal \mathbf{C}^{-1} \mathbf{X}_D ^ \intercal)^{-1} \mathbf{X}_D ^ \intercal \mathbf{C}^{-1} \mathbf{y}
$$</span><br /></p>
</div>
<p>The first term in <span class="math inline">$\hat{\mathbf{b}}$</span> is the phylogenetic mean <span class="math inline">$\bar{z}(0)$</span>. The other term in <span class="math inline">$\hat{\mathbf{b}}$</span> will be an estimate for the slope of the relationship between <span class="math inline"><em>y</em></span> and <span class="math inline"><em>x</em></span>, the calculation of which statistically controls for the effect of phylogenetic relationships.</p>
<p>Applying PGLS to mammal body mass and home range results in an identical estimate of the slope and P-value as we obtain using independent contrasts (see Box 4.1). PGLS also returns an estimate of the intercept of this relationship, which cannot be obtained from the PICs.</p>
<p>Of course, another difference is that PICs and PGLS use regression, while the approach outlined above tests for a correlation. These two types of statistical tests are different. Correlation tests for a relationship between <span class="math inline"><em>x</em></span> and <span class="math inline"><em>y</em></span>, while regression tries to find the best way to predict <span class="math inline"><em>y</em></span> from <span class="math inline"><em>x</em></span>. For correlation, it does not matter which variable we call <span class="math inline"><em>x</em></span> and which we call <span class="math inline"><em>y</em></span>. However, in regression we will get a different slope if we predict <span class="math inline"><em>y</em></span> given <span class="math inline"><em>x</em></span> instead of predicting <span class="math inline"><em>x</em></span> given <span class="math inline"><em>y</em></span>. The model that is assumed by phylogenetic regression models is also different from the model above, where we assumed that the two characters evolve under a correlated Brownian motion model. By contrast, PGLS (and, implicitly, PICs) assume that the deviations of each species from the regression line evolve under a Brownian motion model. We can imagine, for example, that species can freely slide along the regression line, but that evolving around that line can be captured by a normal Brownian model. Another way to think about a PGLS model is that we are treating <span class="math inline"><em>x</em></span> as a fixed property of species. The deviation of <span class="math inline"><em>y</em></span> from what is predicted by <span class="math inline"><em>x</em></span> is what evolves under a Brownian motion model. If this seems strange, that’s because it is! There are other, more complex models for modeling the correlated evolution of two characters that make assumptions that are more evolutionarily realistic <span class="citation">(e.g. Hansen <a href="#ref-Hansen1997-ek">1997</a>)</span>; we will return to this topic later in the book. At the same time, PGLS is a well-used method for evolutionary regression, and is undoubtedly useful despite its somewhat strange assumptions.</p>
<p>PGLS analysis, as described above, assumes that characters are evolving under a Brownian motion model. However, one can change the structure of the error variance-covariance matrix to reflect other models of evolution, such as Ornstein-Uhlenbeck. We return to this topic in a later chapter.</p>
<h2 id="section-5.6-summary">Section 5.6: Summary</h2>
<p>There are at least four methods for testing for an evolutionary correlation between continuous characters: likelihood ratio test, AIC model selection, PICs, and PGLS. These four methods as presented all make the same assumptions about the data and, therefore, have quite similar statistical properties (even simulating under a multivariate Brownian motion model, which deviates from the model assumptions, both PICs and PGLS have appropriate Type I error rates and very similar power). Any of these are good choices for testing for the presence of an evolutionary correlation in your data.</p>
<h2 id="section-5.7-footnotes">Section 5.7: Footnotes</h2>
<p><a name="footnote5.1">1</a>: We might also want to carry out linear regression, which is related to correlation analysis but distinct. We will show examples of phylogenetic regression at the end of this chapter.</p>
<div>
<p><a href="#footnote5.1_back"><em>back to main text</em></a></p>
</div>
<p><a name="footnote5.2">2</a>: Although the joint distribution of all species for a single trait is multivariate normal (see previous chapters), individual changes along a particular branch of a tree are univariate.</p>
<div>
<p><a href="#footnote5.2_back"><em>back to main text</em></a></p>
</div>
<p><a name="footnote5.3">3</a>: Another way to think about regression through the origin is to think of pairs of contrasts across any node in the tree as two-dimensional vectors. Calculating a vector correlation is equivalent to calculating a regression forced through the origin.</p>
<div>
<p><a href="#footnote5.3_back"><em>back to main text</em></a></p>
</div>
<div>
<h2 id="references">References</h2>
</div>

<div id="refs" class="references">
<div id="ref-Felsenstein1985-bt">
<p>Felsenstein, J. 1985. Phylogenies and the comparative method. Am. Nat. 125:1–15.</p>
</div>
<div id="ref-Garland1992-kv">
<p>Garland, T., Jr. 1992. Rate tests for phenotypic evolution using phylogenetically independent contrasts. Am. Nat. 140:509–519.</p>
</div>
<div id="ref-Hansen1997-ek">
<p>Hansen, T. F. 1997. Stabilizing selection and the comparative analysis of adaptation. Evolution 51:1341–1351.</p>
</div>
<div id="ref-Hohenlohe2008-sj">
<p>Hohenlohe, P. A., and S. J. Arnold. 2008. MIPoD: A hypothesis-testing framework for microevolutionary inference from patterns of divergence. Am. Nat. 171:366–385.</p>
</div>
<div id="ref-Revell2008-qr">
<p>Revell, L. J., and L. J. Harmon. 2008. Testing quantitative genetic hypotheses about the evolutionary rate matrix for continuous characters. Evol. Ecol. Res. 10:311–331.</p>
</div>
</div>
</body>
</html>
